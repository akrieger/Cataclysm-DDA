<!DOCTYPE html>
<html>
  <head>
    <title>Cataclysm web linting tool</title>
    <style>
      * { font-family: 'monospace'; }
      input { display: block; }
    </style>
    <script>
      function lint(elem) {
          if (elem.value.length == 0) {
              return false;
          }
          try {
              JSON.parse(elem.value);
          } catch (e) {
              alert('Syntax error');
              return false;
          }

          var xhr = new XMLHttpRequest();
          xhr.open('POST', '/tools/format/format.pl');
          xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
          xhr.onload = function() {
              if (xhr.status == 200) {
                  elem.value = xhr.responseText;
              } else if (xhr.status == 400) {
                  alert(xhr.responseText);
              } else {
                  alert('Linter currently unavailable');
              }
          };
          xhr.send(encodeURI('data=' + elem.value));
          return false; // suppress default form action
      }
    </script>
  </head>
  <body>
    <h1>Cataclysm web linting tool</h1>
    <form onsubmit="return lint(this.getElementsByTagName('textarea')[0]);">
      <textarea name="data" cols="120" rows="30"></textarea>
      <input type="submit"/>
    </form>
  </body>
</html>
